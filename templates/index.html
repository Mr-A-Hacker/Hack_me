<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Metadata Collector Demo</title>
  <style>
    body { background:#0b0b12; color:#f50ac0; font-family:monospace; }
    .panel { border:1px solid #f50ac0; padding:16px; border-radius:12px; box-shadow:0 0 12px #f50ac0; }
    pre { white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>
<body>
  <div class="panel">
    <h2>Metadata Collector Demo</h2>
    <p>This page automatically gathers browser and system metadata.</p>
    <pre id="out"></pre>
  </div>

<script>
async function gatherClientData() {
  const data = {
    screen: screen.width + "x" + screen.height + "@" + screen.colorDepth + "bit",
    tz: Intl.DateTimeFormat().resolvedOptions().timeZone,
    lang: navigator.language,
    cookiesEnabled: navigator.cookieEnabled,
    platform: navigator.platform,
    userAgent: navigator.userAgent,
    online: navigator.onLine,
    cores: navigator.hardwareConcurrency,
    ramGB: navigator.deviceMemory,
    touchPoints: navigator.maxTouchPoints,
    vendor: navigator.vendor,
    productSub: navigator.productSub,
    pixelRatio: window.devicePixelRatio,
    plugins: Array.from(navigator.plugins).map(p => p.name),
    connection: navigator.connection ? {
      downlink: navigator.connection.downlink,
      effectiveType: navigator.connection.effectiveType,
      rtt: navigator.connection.rtt
    } : {}
  };

  if (navigator.getBattery) {
    try {
      const b = await navigator.getBattery();
      data.battery = {
        charging: b.charging,
        level: b.level,
        chargingTime: b.chargingTime,
        dischargingTime: b.dischargingTime
      };
    } catch (err) {
      data.battery = { error: err.message };
    }
  }

  if (navigator.storage && navigator.storage.estimate) {
    try {
      const est = await navigator.storage.estimate();
      data.storage = {
        quota: est.quota,
        usage: est.usage
      };
    } catch (err) {
      data.storage = { error: err.message };
    }
  }

  if (navigator.geolocation) {
    try {
      const pos = await new Promise((resolve, reject) =>
        navigator.geolocation.getCurrentPosition(resolve, reject)
      );
      data.location = {
        lat: pos.coords.latitude,
        lon: pos.coords.longitude,
        accuracy: pos.coords.accuracy
      };
    } catch (err) {
      data.location = { error: err.message };
    }
  } else {
    data.location = { error: "Geolocation not supported" };
  }

  return data;
}

async function autoCollect() {
  const payload = await gatherClientData();
  try {
    const res = await fetch("/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    document.getElementById("out").textContent = JSON.stringify(data.received, null, 2);
  } catch (err) {
    document.getElementById("out").textContent = "Error sending data: " + err;
  }
}

window.onload = autoCollect;
</script>
</body>
</html>
